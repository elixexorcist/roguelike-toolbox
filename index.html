<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Roller</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1d1f21, #282a2e);
            color: #ddd;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
        }

        h1 {
            margin-top: 0;
            text-align: center;
        }

        #controls {
            display: flex;
            margin-bottom: 10px;
        }

        #expression {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px;
            margin-right: 5px;
        }

        #roll {
            padding: 8px 16px;
            border: none;
            background: #3d8;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }

        #roll:hover {
            background: #2c6;
        }

        #dice-buttons button,
        #custom {
            margin: 5px 3px 0 0;
            padding: 6px 10px;
            border: none;
            background: #555;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }

        #dice-buttons button:hover,
        #custom:hover {
            background: #777;
        }

        #result {
            margin-top: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Dice Roller</h1>
    <div id="controls">
        <input type="text" id="expression" placeholder="e.g. 1d20+5+1d6" />
        <button id="roll">Roll</button>
    </div>
    <div id="dice-buttons">
        <button data-dice="4">+d4</button>
        <button data-dice="6">+d6</button>
        <button data-dice="8">+d8</button>
        <button data-dice="10">+d10</button>
        <button data-dice="12">+d12</button>
        <button data-dice="20">+d20</button>
        <button id="custom">+custom</button>
    </div>
    <div id="result"></div>
</div>
<script>
function rollExpression(expr) {
    expr = expr.replace(/\s+/g, '');
    const tokens = expr.match(/[+-]?\d+d\d+|[+-]?\d+/g);
    if (!tokens) return NaN;
    let total = 0;
    let breakdown = [];
    for (const token of tokens) {
        let sign = 1;
        let t = token;
        if (t[0] === '+' || t[0] === '-') {
            sign = t[0] === '-' ? -1 : 1;
            t = t.slice(1);
        }
        if (t.includes('d')) {
            const [num, sides] = t.split('d').map(Number);
            for (let i = 0; i < num; i++) {
                const roll = Math.floor(Math.random() * sides) + 1;
                total += sign * roll;
                breakdown.push(`${sign===-1?'-':''}${roll}`);
            }
        } else {
            total += sign * parseInt(t, 10);
            breakdown.push(`${sign===-1?'-':''}${parseInt(t, 10)}`);
        }
    }
    return { total, breakdown: breakdown.join(' + ') };
}

document.getElementById('roll').onclick = function() {
    const expr = document.getElementById('expression').value;
    const res = rollExpression(expr);
    if (isNaN(res.total)) {
        document.getElementById('result').textContent = 'Invalid expression.';
    } else {
        document.getElementById('result').textContent = `${expr} = ${res.total} (rolled: ${res.breakdown})`;
    }
};

document.querySelectorAll('#dice-buttons button[data-dice]').forEach(btn => {
    btn.onclick = () => {
        const dice = btn.getAttribute('data-dice');
        const input = document.getElementById('expression');
        input.value += (input.value ? '+' : '') + '1d' + dice;
    };
});

document.getElementById('custom').onclick = () => {
    const sides = prompt('Number of sides?');
    if (!sides) return;
    const input = document.getElementById('expression');
    input.value += (input.value ? '+' : '') + '1d' + parseInt(sides, 10);
};
</script>
</body>
</html>
